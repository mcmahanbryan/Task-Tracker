<%- include('partials/header') %>

<script>
  $("#navbarCollapse > ul > li:nth-child(1)").addClass("active");
</script>

<div class="container-fluid index-spacing">
  <div class="row">
    <div class="col-lg-6">
      <table class="today-table">
        <colgroup>
          <col span="1" style="width: 65%" />
          <col span="1" style="width: 20%" />
          <col span="1" style="width: 15%" />
        </colgroup>
        <thead>
          <tr>
            <th class="today-title today-bigger-headings">Today's Tasks</th>
            <th class="today-title today-smaller-headings">Type</th>
            <th class="today-title today-smaller-headings">End Date</th>
          </tr>
        </thead>
        <tbody class='task-table-body'>
        </tbody>
      </table>
    </div>
    <div id="open-weather" class="col-lg-6 weather"></div>
  </div>
</div>

<%- include('partials/footer') %>


<!-- Populates the table body with today's tasks
 -------------------------------------------------->
 <script>
  const htmlText = `<%- htmlText %>`;
  const taskTable = document.querySelector('.task-table-body');
  taskTable.innerHTML = '';
  taskTable.innerHTML = htmlText;
</script>


<!-- Edit Task Modal 
    -------------------------------------------------->
<div
  id="editTaskModal"
  class="modal fade"
  tabindex="-1"
  role="dialog"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content"></div>
  </div>
</div>
<script>
  $(".edit-modal").on("click", function (e) {
    e.preventDefault();
    $("#editTaskModal")
      .modal("show")
      .find(".modal-content")
      .load($(this).attr("onclick"));
  });
</script>

<script>
  const key = `<%- apiKey %>`;
  console.log(key);
  $.ajax({
    type:"POST",
    url: `http://api.openweathermap.org/data/2.5/weather?id=4402245&appid=${key}&units=imperial`,
    dataType: "json",
    success: function (result) {
      console.log(result);

      const weatherHtml = `
        <h6>${result.name}</h6>
        <p>${result.weather[0].main}</p>
        <p>Feels like: ${result.main.feels_like}</p>
        <p>Actual temperature:  ${result.main.temp}</p>
        `;

      document.querySelector("#open-weather").innerHTML = weatherHtml;
    }
  });
</script>